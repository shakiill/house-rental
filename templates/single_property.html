{% extends 'front.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}
    <section class="form-section bg-white">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="card card-custom gutter-b" style="background: #0BB7AF;padding: 2px">
                        <div id="demo" class="carousel slide" data-ride="carousel">

                            <!-- Indicators -->
                            <ul class="carousel-indicators">
                                <li data-target="#demo" data-slide-to="0" class="active"></li>
                                <li data-target="#demo" data-slide-to="1"></li>
                                <li data-target="#demo" data-slide-to="2"></li>
                                <li data-target="#demo" data-slide-to="3"></li>
                            </ul>

                            <!-- The slideshow -->
                            <div class="carousel-inner">
                                <div class="carousel-item active">
                                    <img src="{{ object.thumbnail.url }}" alt="Los Angeles">
                                </div>
                                <div class="carousel-item">
                                    <img src="{{ object.image_1.url }}" alt="Chicago">
                                </div>
                                <div class="carousel-item">
                                    <img src="{{ object.image_2.url }}" alt="New York">
                                </div>
                                <div class="carousel-item">
                                    <img src="{{ object.image_3.url }}" alt="New York">
                                </div>
                            </div>

                            <!-- Left and right controls -->
                            <a class="carousel-control-prev" href="#demo" data-slide="prev">
                                <span class="carousel-control-prev-icon"></span>
                            </a>
                            <a class="carousel-control-next" href="#demo" data-slide="next">
                                <span class="carousel-control-next-icon"></span>
                            </a>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 p-25">
                    <h2>{{ object.title }}</h2>
                    <ul>
                        <li>Area: {{ object.area }}</li>
                        <li>Room: {{ object.room }} sqft</li>
                        <li>Floor: {{ object.floor }}</li>
                        <li>Lift: {{ object.lift|yesno }}</li>
                        <li>Parking: {{ object.parking|yesno }}</li>
                        <li>Rent: {{ object.rent }} BDT</li>
                        <li>Location: {{ object.address }}</li>
                    </ul>
                    <br>
                    {% if user.is_authenticated %}
                        {% if status == True or status == 'status' %}
                            <h4>Already Applied</h4>
                        {% else %}
                            <a onclick="submitForm()" class="btn btn-instagram">Book Now</a>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'account_login' %}" class="btn btn-instagram">Book Now</a>
                    {% endif %}
                </div>
            </div>
            <div class="row">
                <div class="col p-25">
                    {{ object.description |safe }}
                </div>
            </div>
        </div>
    </section>

{% endblock %}
{% block css %}

    <style>
        .filter-section {
            background: url("{% static 'images/bg/bg-8.jpg' %}");
            padding-top: 50px;
            padding-bottom: 50px;
        }

        .form-section {
            padding-top: 50px;
            padding-bottom: 50px;
        }

        .carousel-item img {
            width: 100%;
            height: 500px;
            overflow: hidden;
        }
    </style>
{% endblock %}
{% block js %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="{% static 'plugins/global/plugins.bundle.js' %}"></script>
    <script src="{% static 'plugins/global/toastr.js' %}"></script>
    <script src="{% static 'js/scripts.bundle.js' %}"></script>
    <script src="{% static 'plugins/quill/quill.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'plugins/quill/quill-textarea.js' %}" type="text/javascript"></script>
    <script src="{% static 'plugins/django_select2/django_select2.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/main.js' %}"></script>
    {#<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>#}
    {#<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap4.min.js"></script>#}

    <script type="text/javascript" src="https://www.youtube.com/iframe_api"></script>
    <script type="text/javascript"
            src="https://www.jqueryscript.net/demo/performance-youtube-video-embed/jquery.embedVideo.js?v=1.1"></script>
    <script type="text/javascript">
        function onYouTubeIframeAPIReady() {
            $('.embed-video').embedVideo({
                enablejsapi: 1,
                callback: function (iframe) {
                    player = new YT.Player(iframe, {
                        events: {
                            'onReady': function () {
                                if (!$(iframe).parent().data('autoplay')) {
                                    player.playVideo();
                                }
                            }
                        }
                    });
                }
            });
        }
    </script>

    {% if messages %}
        <script>
            {% for message in messages %}
                toastr['{{ message.tags }}']("{{ message }}");
            {% endfor %}
        </script>
    {% endif %}
    <script>
        function submitForm() {
            var data = {
                'apartment': {{ object.pk }},
            };
            $.ajax({
                type: "POST",
                url: "/api/bookings/",
                csrfmiddlewaretoken: "{{ csrf_token }}",
                data: JSON.stringify(data),
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                success: function () {
                    Swal.fire(
                        'Entry successfully added',
                        'You clicked the button!',
                        'success'
                    );
                    window.location.reload()
                    // window.location.href = '/sales/{{ object.pk }}/info/?tab=tab_2';
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest, textStatus, errorThrown);
                    alert("some error " + String(errorThrown) + String(textStatus) + String(XMLHttpRequest.responseText));
                }
            });
        }
    </script>
{% endblock %}
